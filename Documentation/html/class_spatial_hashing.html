<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Smooth Particle Hydrodynamics Solver for Lagrangian Fluid Simulation: SpatialHashing Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>SpatialHashing Class Reference</h1><!-- doxytag: class="SpatialHashing" -->
<p>implements spatial hashing for the search of fluid particle neighbours  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>&gt;</code></p>

<p><a href="class_spatial_hashing-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a98c165ee367f6fbd6a755bcdd46e0d98">SpatialHashing</a> (const int _numberOfFluidParticles, const float _smoothingLength)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">ctor  <a href="#a98c165ee367f6fbd6a755bcdd46e0d98"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a5799e4a0ffdbd11c5202aa13d15dc313">~SpatialHashing</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">dtor  <a href="#a5799e4a0ffdbd11c5202aa13d15dc313"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#aeb15873f735e15a7b3fa8d3cc211db93">initialiseSpatialHashing</a> (const int _numberOfFluidParticles, const float _smoothingLength)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initialiseSpatialHashing the spatial structure  <a href="#aeb15873f735e15a7b3fa8d3cc211db93"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#acd1b87ec8ea289a18d431b7a3fde50c0">refreshHashmap</a> (std::vector&lt; <a class="el" href="class_fluid_particle.html">FluidParticle</a> &gt; &amp;_particleList)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">refresh the hash map at each iteration  <a href="#acd1b87ec8ea289a18d431b7a3fde50c0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a58638653aed1d4d304c6e2aa839ba9ba">clearHashmap</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">clear the hash map  <a href="#a58638653aed1d4d304c6e2aa839ba9ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_fluid_particle.html">FluidParticle</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#af5c8f67520bfd03e32800e87af56ffba">searchFluidParticleNeighbours</a> (const ngl::Vector _centerPosition)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return neighbours of a particle  <a href="#af5c8f67520bfd03e32800e87af56ffba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a430ce0c699a8ef34a5f8f152d59f06a8">setCellSize</a> (const ngl::Real _size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set the cell size of the spatial structure  <a href="#a430ce0c699a8ef34a5f8f152d59f06a8"></a><br/></td></tr>
<tr><td colspan="2"><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a810e4bfd1e5ec0869dfa3bdefd3a1d42">modulus</a> (const int _a, const int _b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">calculate the modulus of 2 numbers  <a href="#a810e4bfd1e5ec0869dfa3bdefd3a1d42"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#ab9a10a48fe163699f3e35e36d310254d">getNextPrimeNumber</a> (const int _start)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return the next prime number  <a href="#ab9a10a48fe163699f3e35e36d310254d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#addbd2cd5fde1521533a54ade79787dde">discretizingVector</a> (const ngl::Vector _position)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">discretise an array of vectors into an array of integers  <a href="#addbd2cd5fde1521533a54ade79787dde"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a7bfce8fdfb8f8afe9a23fe1fe39875fe">hashPosition</a> (const ngl::Vector _position)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hash a position to a hash key  <a href="#a7bfce8fdfb8f8afe9a23fe1fe39875fe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#ad75a31f38142a1c2a03eda6afed94db3">getNeighbouringCells</a> (const ngl::Vector _centerPosition, const bool _checkNeighboursAreInSmoothingLength, std::vector&lt; <a class="el" href="class_fluid_particle.html">FluidParticle</a> &gt; &amp;o_neighbourList)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">determine neighbours of a fluid particle, given its position  <a href="#ad75a31f38142a1c2a03eda6afed94db3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#ac8700af92ae1d6729b29307926bd2a09">inListCheck</a> (const int _testId, std::vector&lt; <a class="el" href="class_fluid_particle.html">FluidParticle</a> &gt; &amp;_neighbourList)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">check if a neighbour is a duplicate  <a href="#ac8700af92ae1d6729b29307926bd2a09"></a><br/></td></tr>
<tr><td colspan="2"><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_spatial_hashing_8h.html#a1b38b0ad37d6e1390643e8d735273c7f">hashmap</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#aa4c4c1eaf23e54dd42cc982a4e53ceaf">m_hashMap</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the spatial hash map  <a href="#aa4c4c1eaf23e54dd42cc982a4e53ceaf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c">m_cellSize</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the cell size used for spatial calculations  <a href="#aed10321da282b758d14dd3112749197c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a3062fc7637f6ba8aca2d4b74a3f96b9b">m_mapSize</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the map size  <a href="#a3062fc7637f6ba8aca2d4b74a3f96b9b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a99c2a49c03963d35b4961c51642582b3">m_firstLargePrimeNumber</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">large prime number 1  <a href="#a99c2a49c03963d35b4961c51642582b3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a80745b4791c3f19b1c2170c18b0832ac">m_secondLargePrimeNumber</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">large prime number 2  <a href="#a80745b4791c3f19b1c2170c18b0832ac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a705bb42422d5edd7d8605f95618760c1">m_thirdLargePrimeNumber</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">large prime number 3  <a href="#a705bb42422d5edd7d8605f95618760c1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_spatial_hashing.html#a553569ddd4a57714697c57b70e850d9d">m_initialNeighbourListSize</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">reserved space size for neighbours  <a href="#a553569ddd4a57714697c57b70e850d9d"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>implements spatial hashing for the search of fluid particle neighbours </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00021">21</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a98c165ee367f6fbd6a755bcdd46e0d98"></a><!-- doxytag: member="SpatialHashing::SpatialHashing" ref="a98c165ee367f6fbd6a755bcdd46e0d98" args="(const int _numberOfFluidParticles, const float _smoothingLength)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SpatialHashing::SpatialHashing </td>
          <td>(</td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>_numberOfFluidParticles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float&nbsp;</td>
          <td class="paramname"> <em>_smoothingLength</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>ctor </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_numberOfFluidParticles</em>&nbsp;</td><td>the fluid particle count </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_smoothingLength</em>&nbsp;</td><td>the smoothing length </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00010">10</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00014"></a>00014 {
<a name="l00015"></a>00015     <span class="comment">//initialise large prime numbers</span>
<a name="l00016"></a>00016     <a class="code" href="class_spatial_hashing.html#a99c2a49c03963d35b4961c51642582b3" title="large prime number 1">m_firstLargePrimeNumber</a> = 73856093;
<a name="l00017"></a>00017     <a class="code" href="class_spatial_hashing.html#a80745b4791c3f19b1c2170c18b0832ac" title="large prime number 2">m_secondLargePrimeNumber</a> = 19349663;
<a name="l00018"></a>00018     <a class="code" href="class_spatial_hashing.html#a705bb42422d5edd7d8605f95618760c1" title="large prime number 3">m_thirdLargePrimeNumber</a> = 83492791;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020     <span class="comment">//initialise neighbour list</span>
<a name="l00021"></a>00021     <a class="code" href="class_spatial_hashing.html#a553569ddd4a57714697c57b70e850d9d" title="reserved space size for neighbours">m_initialNeighbourListSize</a> = 50;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023     <span class="comment">//initialise hash params</span>
<a name="l00024"></a>00024     <a class="code" href="class_spatial_hashing.html#aeb15873f735e15a7b3fa8d3cc211db93" title="initialiseSpatialHashing the spatial structure">initialiseSpatialHashing</a>(_numberOfFluidParticles, _smoothingLength);
<a name="l00025"></a>00025 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5799e4a0ffdbd11c5202aa13d15dc313"></a><!-- doxytag: member="SpatialHashing::~SpatialHashing" ref="a5799e4a0ffdbd11c5202aa13d15dc313" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SpatialHashing::~SpatialHashing </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>dtor </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00027">27</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00028"></a>00028 {
<a name="l00029"></a>00029     <span class="comment">//clean up</span>
<a name="l00030"></a>00030     std::cout &lt;&lt; <span class="stringliteral">&quot;Neighbour Cleanup&quot;</span> &lt;&lt; std::endl;
<a name="l00031"></a>00031 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a58638653aed1d4d304c6e2aa839ba9ba"></a><!-- doxytag: member="SpatialHashing::clearHashmap" ref="a58638653aed1d4d304c6e2aa839ba9ba" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SpatialHashing::clearHashmap </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>clear the hash map </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00162">162</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p>References <a class="el" href="_spatial_hashing_8h_source.html#l00063">m_hashMap</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00163"></a>00163 {
<a name="l00164"></a>00164     <span class="comment">//clears hashmap</span>
<a name="l00165"></a>00165     <a class="code" href="class_spatial_hashing.html#aa4c4c1eaf23e54dd42cc982a4e53ceaf" title="the spatial hash map">m_hashMap</a>.clear();
<a name="l00166"></a>00166 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="addbd2cd5fde1521533a54ade79787dde"></a><!-- doxytag: member="SpatialHashing::discretizingVector" ref="addbd2cd5fde1521533a54ade79787dde" args="(const ngl::Vector _position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; int &gt; SpatialHashing::discretizingVector </td>
          <td>(</td>
          <td class="paramtype">const ngl::Vector&nbsp;</td>
          <td class="paramname"> <em>_position</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>discretise an array of vectors into an array of integers </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_position</em>&nbsp;</td><td>the vector position to discretize </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00124">124</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p>References <a class="el" href="_spatial_hashing_8h_source.html#l00066">m_cellSize</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00125"></a>00125 {
<a name="l00126"></a>00126     std::vector&lt;int&gt; pos;
<a name="l00127"></a>00127     pos.reserve(3);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     pos.push_back(floor(_position.m_x / <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a>));
<a name="l00130"></a>00130     pos.push_back(floor(_position.m_y / <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a>));
<a name="l00131"></a>00131     pos.push_back(floor(_position.m_z / <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a>));
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="keywordflow">return</span> pos;
<a name="l00134"></a>00134 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="class_spatial_hashing_addbd2cd5fde1521533a54ade79787dde_icgraph.png" border="0" usemap="#class_spatial_hashing_addbd2cd5fde1521533a54ade79787dde_icgraph_map" alt=""></div>
<map name="class_spatial_hashing_addbd2cd5fde1521533a54ade79787dde_icgraph_map" id="class_spatial_hashing_addbd2cd5fde1521533a54ade79787dde_icgraph">
<area shape="rect" href="class_spatial_hashing.html#a7bfce8fdfb8f8afe9a23fe1fe39875fe" title="hash a position to a hash key" alt="" coords="325,5,517,32"/><area shape="rect" href="class_spatial_hashing.html#af5c8f67520bfd03e32800e87af56ffba" title="return neighbours of a particle" alt="" coords="276,56,567,83"/><area shape="rect" href="class_spatial_hashing.html#acd1b87ec8ea289a18d431b7a3fde50c0" title="refresh the hash map at each iteration" alt="" coords="616,5,827,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad75a31f38142a1c2a03eda6afed94db3"></a><!-- doxytag: member="SpatialHashing::getNeighbouringCells" ref="ad75a31f38142a1c2a03eda6afed94db3" args="(const ngl::Vector _centerPosition, const bool _checkNeighboursAreInSmoothingLength, std::vector&lt; FluidParticle &gt; &amp;o_neighbourList)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SpatialHashing::getNeighbouringCells </td>
          <td>(</td>
          <td class="paramtype">const ngl::Vector&nbsp;</td>
          <td class="paramname"> <em>_centerPosition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&nbsp;</td>
          <td class="paramname"> <em>_checkNeighboursAreInSmoothingLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="class_fluid_particle.html">FluidParticle</a> &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>o_neighbourList</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>determine neighbours of a fluid particle, given its position </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_centerPosition</em>&nbsp;</td><td>the position of the fluid particle </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_checkNeighboursAreInSmoothingLength</em>&nbsp;</td><td>flag to determine whether only neighbours within the smoothing length are added </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>o_neighbourList</em>&nbsp;</td><td>stores the list neighbours </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00191">191</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p>References <a class="el" href="_particle_8h_source.html#l00063">Particle::getCurrentPosition()</a>, and <a class="el" href="_particle_8h_source.html#l00050">Particle::getId()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <span class="comment">//hash position</span>
<a name="l00198"></a>00198     <span class="keywordtype">int</span> hashKey = <a class="code" href="class_spatial_hashing.html#a7bfce8fdfb8f8afe9a23fe1fe39875fe" title="hash a position to a hash key">hashPosition</a>(_centerPosition);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="comment">//get particles of cell[hashkey] from hash map</span>
<a name="l00201"></a>00201     std::pair&lt;hashmap::iterator, hashmap::iterator&gt; neighbourCandidateList = <a class="code" href="class_spatial_hashing.html#aa4c4c1eaf23e54dd42cc982a4e53ceaf" title="the spatial hash map">m_hashMap</a>.equal_range(hashKey);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="comment">//loop over neighbour list</span>
<a name="l00204"></a>00204     <span class="keywordflow">for</span> (hashmap::iterator candidate = neighbourCandidateList.first; candidate != neighbourCandidateList.second; candidate++)
<a name="l00205"></a>00205     {
<a name="l00206"></a>00206         <span class="comment">//get neighbour particle</span>
<a name="l00207"></a>00207         <a class="code" href="class_fluid_particle.html" title="stores all attributes for a fluid for use with SPH">FluidParticle</a> neighbourCandidate = (*candidate).second;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <span class="comment">//consider only non-duplicate candidates</span>
<a name="l00210"></a>00210         <span class="keywordflow">if</span> (!<a class="code" href="class_spatial_hashing.html#ac8700af92ae1d6729b29307926bd2a09" title="check if a neighbour is a duplicate">inListCheck</a>(neighbourCandidate.<a class="code" href="class_particle.html#ad9688047786047c9fecf0c304b4f6294" title="return the id">getId</a>(), o_neighbourList))
<a name="l00211"></a>00211         {
<a name="l00212"></a>00212             <span class="comment">//assume neighbour is valid</span>
<a name="l00213"></a>00213             <span class="keywordtype">bool</span> isValidToAdd = <span class="keyword">true</span>;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215             <span class="comment">//filter only neighbours within smoothing length if check is enabled</span>
<a name="l00216"></a>00216             <span class="keywordflow">if</span> (_checkNeighboursAreInSmoothingLength)
<a name="l00217"></a>00217             {
<a name="l00218"></a>00218                 <span class="comment">//get separation distance between centerposition and neighbour position</span>
<a name="l00219"></a>00219                 ngl::Real distance = (_centerPosition - neighbourCandidate.<a class="code" href="class_particle.html#a7bb9e571a782e273da7efcf77b3b578f" title="return the current position">getCurrentPosition</a>()).length();
<a name="l00220"></a>00220 
<a name="l00221"></a>00221                 <span class="comment">//check if distance is within smoothing length (cell size)</span>
<a name="l00222"></a>00222                 <span class="keywordflow">if</span> (distance &gt; <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a>) isValidToAdd = <span class="keyword">false</span>;
<a name="l00223"></a>00223             }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225             <span class="comment">//add neighbour particle to neighbour list if valid</span>
<a name="l00226"></a>00226             <span class="keywordflow">if</span> (isValidToAdd) o_neighbourList.push_back(neighbourCandidate);
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="class_spatial_hashing_ad75a31f38142a1c2a03eda6afed94db3_cgraph.png" border="0" usemap="#class_spatial_hashing_ad75a31f38142a1c2a03eda6afed94db3_cgraph_map" alt=""></div>
<map name="class_spatial_hashing_ad75a31f38142a1c2a03eda6afed94db3_cgraph_map" id="class_spatial_hashing_ad75a31f38142a1c2a03eda6afed94db3_cgraph">
<area shape="rect" href="class_particle.html#a7bb9e571a782e273da7efcf77b3b578f" title="return the current position" alt="" coords="295,5,473,32"/><area shape="rect" href="class_particle.html#ad9688047786047c9fecf0c304b4f6294" title="return the id" alt="" coords="333,56,435,83"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="class_spatial_hashing_ad75a31f38142a1c2a03eda6afed94db3_icgraph.png" border="0" usemap="#class_spatial_hashing_ad75a31f38142a1c2a03eda6afed94db3_icgraph_map" alt=""></div>
<map name="class_spatial_hashing_ad75a31f38142a1c2a03eda6afed94db3_icgraph_map" id="class_spatial_hashing_ad75a31f38142a1c2a03eda6afed94db3_icgraph">
<area shape="rect" href="class_spatial_hashing.html#af5c8f67520bfd03e32800e87af56ffba" title="return neighbours of a particle" alt="" coords="295,5,585,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab9a10a48fe163699f3e35e36d310254d"></a><!-- doxytag: member="SpatialHashing::getNextPrimeNumber" ref="ab9a10a48fe163699f3e35e36d310254d" args="(const int _start)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpatialHashing::getNextPrimeNumber </td>
          <td>(</td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>_start</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return the next prime number </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_start</em>&nbsp;</td><td>the start number from which to find the next prime number </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00059">59</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00060"></a>00060 {
<a name="l00061"></a>00061     <span class="keywordtype">int</span> i = _start;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <span class="keywordtype">bool</span> isPrimeNumberFound = <span class="keyword">true</span>;
<a name="l00064"></a>00064     <span class="keywordtype">bool</span> isNextPrimeNumberFound = <span class="keyword">false</span>;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="comment">//Get Square root of number and iterate, start from 2</span>
<a name="l00067"></a>00067     <span class="keywordtype">int</span> check = (int)sqrt((<span class="keywordtype">double</span>)i);
<a name="l00068"></a>00068     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 2; j &lt;= check; j++)
<a name="l00069"></a>00069     {
<a name="l00070"></a>00070         <span class="keywordflow">if</span> (i % j == 0)
<a name="l00071"></a>00071         {
<a name="l00072"></a>00072             isPrimeNumberFound = <span class="keyword">false</span>;
<a name="l00073"></a>00073             <span class="keywordflow">break</span>;
<a name="l00074"></a>00074         }
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076     <span class="keywordflow">if</span> (isPrimeNumberFound)
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078         <span class="comment">//i itself is the next prime number</span>
<a name="l00079"></a>00079         <span class="keywordflow">return</span> i;
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081     <span class="keywordflow">else</span>
<a name="l00082"></a>00082     {
<a name="l00083"></a>00083         <span class="comment">//i is not a prime number -&gt; must search next one</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         i++;
<a name="l00086"></a>00086         isPrimeNumberFound = <span class="keyword">true</span>;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088         <span class="comment">// Increment current number to find next prime number</span>
<a name="l00089"></a>00089         <span class="keywordflow">while</span> (isNextPrimeNumberFound == <span class="keyword">false</span>)
<a name="l00090"></a>00090         {
<a name="l00091"></a>00091             check = (int)sqrt((<span class="keywordtype">double</span>)(i));
<a name="l00092"></a>00092 
<a name="l00093"></a>00093             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 2; j &lt;= check; j++)
<a name="l00094"></a>00094             {
<a name="l00095"></a>00095                 <span class="keywordflow">if</span> (i % j == 0)
<a name="l00096"></a>00096                 {
<a name="l00097"></a>00097                     isPrimeNumberFound = <span class="keyword">false</span>;
<a name="l00098"></a>00098                     <span class="keywordflow">break</span>;
<a name="l00099"></a>00099                 }
<a name="l00100"></a>00100             }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102             <span class="keywordflow">if</span> (isPrimeNumberFound)
<a name="l00103"></a>00103                 isNextPrimeNumberFound = <span class="keyword">true</span>;
<a name="l00104"></a>00104             <span class="keywordflow">else</span>
<a name="l00105"></a>00105             {
<a name="l00106"></a>00106                 i++;
<a name="l00107"></a>00107                 isPrimeNumberFound = <span class="keyword">true</span>;
<a name="l00108"></a>00108             }
<a name="l00109"></a>00109         }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="keywordflow">if</span> (isNextPrimeNumberFound)
<a name="l00112"></a>00112         {
<a name="l00113"></a>00113             <span class="comment">//i is the next prime number</span>
<a name="l00114"></a>00114 
<a name="l00115"></a>00115             <span class="keywordflow">return</span> i;
<a name="l00116"></a>00116         }
<a name="l00117"></a>00117     }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="comment">//eventually, nothing found?</span>
<a name="l00120"></a>00120     <span class="keywordflow">return</span> _start;
<a name="l00121"></a>00121 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7bfce8fdfb8f8afe9a23fe1fe39875fe"></a><!-- doxytag: member="SpatialHashing::hashPosition" ref="a7bfce8fdfb8f8afe9a23fe1fe39875fe" args="(const ngl::Vector _position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpatialHashing::hashPosition </td>
          <td>(</td>
          <td class="paramtype">const ngl::Vector&nbsp;</td>
          <td class="paramname"> <em>_position</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>hash a position to a hash key </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_position</em>&nbsp;</td><td>the position to hash </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00136">136</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p>References <a class="el" href="_spatial_hashing_8cpp_source.html#l00124">discretizingVector()</a>, <a class="el" href="_spatial_hashing_8h_source.html#l00072">m_firstLargePrimeNumber</a>, <a class="el" href="_spatial_hashing_8h_source.html#l00069">m_mapSize</a>, <a class="el" href="_spatial_hashing_8h_source.html#l00075">m_secondLargePrimeNumber</a>, <a class="el" href="_spatial_hashing_8h_source.html#l00078">m_thirdLargePrimeNumber</a>, and <a class="el" href="_spatial_hashing_8cpp_source.html#l00046">modulus()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <span class="comment">//discretizingVector position to array of int</span>
<a name="l00139"></a>00139     std::vector&lt;int&gt; discretePosition = <a class="code" href="class_spatial_hashing.html#addbd2cd5fde1521533a54ade79787dde" title="discretise an array of vectors into an array of integers">discretizingVector</a>(_position);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     <span class="comment">//calculate hash key</span>
<a name="l00142"></a>00142     <span class="keywordtype">int</span> key = <a class="code" href="class_spatial_hashing.html#a810e4bfd1e5ec0869dfa3bdefd3a1d42" title="calculate the modulus of 2 numbers">modulus</a>((discretePosition[0] * <a class="code" href="class_spatial_hashing.html#a99c2a49c03963d35b4961c51642582b3" title="large prime number 1">m_firstLargePrimeNumber</a>) ^ (discretePosition[1] * <a class="code" href="class_spatial_hashing.html#a80745b4791c3f19b1c2170c18b0832ac" title="large prime number 2">m_secondLargePrimeNumber</a>) ^ (discretePosition[2] * <a class="code" href="class_spatial_hashing.html#a705bb42422d5edd7d8605f95618760c1" title="large prime number 3">m_thirdLargePrimeNumber</a>), <a class="code" href="class_spatial_hashing.html#a3062fc7637f6ba8aca2d4b74a3f96b9b" title="the map size">m_mapSize</a>);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keywordflow">return</span> key;
<a name="l00145"></a>00145 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="class_spatial_hashing_a7bfce8fdfb8f8afe9a23fe1fe39875fe_cgraph.png" border="0" usemap="#class_spatial_hashing_a7bfce8fdfb8f8afe9a23fe1fe39875fe_cgraph_map" alt=""></div>
<map name="class_spatial_hashing_a7bfce8fdfb8f8afe9a23fe1fe39875fe_cgraph_map" id="class_spatial_hashing_a7bfce8fdfb8f8afe9a23fe1fe39875fe_cgraph">
<area shape="rect" href="class_spatial_hashing.html#addbd2cd5fde1521533a54ade79787dde" title="discretise an array of vectors into an array of integers" alt="" coords="247,5,465,32"/><area shape="rect" href="class_spatial_hashing.html#a810e4bfd1e5ec0869dfa3bdefd3a1d42" title="calculate the modulus of 2 numbers" alt="" coords="273,56,439,83"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="class_spatial_hashing_a7bfce8fdfb8f8afe9a23fe1fe39875fe_icgraph.png" border="0" usemap="#class_spatial_hashing_a7bfce8fdfb8f8afe9a23fe1fe39875fe_icgraph_map" alt=""></div>
<map name="class_spatial_hashing_a7bfce8fdfb8f8afe9a23fe1fe39875fe_icgraph_map" id="class_spatial_hashing_a7bfce8fdfb8f8afe9a23fe1fe39875fe_icgraph">
<area shape="rect" href="class_spatial_hashing.html#acd1b87ec8ea289a18d431b7a3fde50c0" title="refresh the hash map at each iteration" alt="" coords="245,5,456,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aeb15873f735e15a7b3fa8d3cc211db93"></a><!-- doxytag: member="SpatialHashing::initialiseSpatialHashing" ref="aeb15873f735e15a7b3fa8d3cc211db93" args="(const int _numberOfFluidParticles, const float _smoothingLength)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SpatialHashing::initialiseSpatialHashing </td>
          <td>(</td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>_numberOfFluidParticles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float&nbsp;</td>
          <td class="paramname"> <em>_smoothingLength</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialiseSpatialHashing the spatial structure </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_numberOfFluidParticles</em>&nbsp;</td><td>the fluid particle count </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_smoothingLength</em>&nbsp;</td><td>the smoothing length </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00034">34</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00038"></a>00038 {
<a name="l00039"></a>00039     <span class="comment">//initialise cell size</span>
<a name="l00040"></a>00040     <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a> = _smoothingLength;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     <span class="comment">//initialise hash map size</span>
<a name="l00043"></a>00043     <a class="code" href="class_spatial_hashing.html#a3062fc7637f6ba8aca2d4b74a3f96b9b" title="the map size">m_mapSize</a> = <a class="code" href="class_spatial_hashing.html#ab9a10a48fe163699f3e35e36d310254d" title="return the next prime number">getNextPrimeNumber</a>(2 * _numberOfFluidParticles);
<a name="l00044"></a>00044 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac8700af92ae1d6729b29307926bd2a09"></a><!-- doxytag: member="SpatialHashing::inListCheck" ref="ac8700af92ae1d6729b29307926bd2a09" args="(const int _testId, std::vector&lt; FluidParticle &gt; &amp;_neighbourList)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SpatialHashing::inListCheck </td>
          <td>(</td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>_testId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="class_fluid_particle.html">FluidParticle</a> &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>_neighbourList</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>check if a neighbour is a duplicate </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_testId</em>&nbsp;</td><td>the id of the neighbour to check in the list </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_neighbourList</em>&nbsp;</td><td>the list of neighbour that will be used for the duplicate check </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00169">169</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <span class="comment">//assume not found</span>
<a name="l00175"></a>00175     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     <span class="comment">//loop through the temporary neighbour list</span>
<a name="l00178"></a>00178     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _neighbourList.size(); i++)
<a name="l00179"></a>00179     {
<a name="l00180"></a>00180         <span class="keywordflow">if</span> (_neighbourList[i].getId() == _testId)
<a name="l00181"></a>00181         {
<a name="l00182"></a>00182             found = <span class="keyword">true</span>;
<a name="l00183"></a>00183             <span class="keywordflow">break</span>;
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="keywordflow">return</span> found;
<a name="l00188"></a>00188 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a810e4bfd1e5ec0869dfa3bdefd3a1d42"></a><!-- doxytag: member="SpatialHashing::modulus" ref="a810e4bfd1e5ec0869dfa3bdefd3a1d42" args="(const int _a, const int _b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpatialHashing::modulus </td>
          <td>(</td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>_b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>calculate the modulus of 2 numbers </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_a</em>&nbsp;</td><td>the first number </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_b</em>&nbsp;</td><td>the second number </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00046">46</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00047"></a>00047 {
<a name="l00048"></a>00048     <span class="comment">//perform huge integer modulus</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050     <span class="comment">//issue of negative modulus : http://mathforum.org/library/drmath/view/52343.html</span>
<a name="l00051"></a>00051     <span class="comment">//solved at stackoverflow : http://stackoverflow.com/questions/1082917/mod-of-negative-number-is-melting-my-brain</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053     <span class="comment">//adapted from StackOverflow</span>
<a name="l00054"></a>00054     <span class="keywordtype">int</span> <a class="code" href="class_spatial_hashing.html#a810e4bfd1e5ec0869dfa3bdefd3a1d42" title="calculate the modulus of 2 numbers">modulus</a> = _a % _b;
<a name="l00055"></a>00055     <span class="keywordflow">return</span> modulus &lt; 0 ? modulus + _b : modulus;
<a name="l00056"></a>00056 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="class_spatial_hashing_a810e4bfd1e5ec0869dfa3bdefd3a1d42_icgraph.png" border="0" usemap="#class_spatial_hashing_a810e4bfd1e5ec0869dfa3bdefd3a1d42_icgraph_map" alt=""></div>
<map name="class_spatial_hashing_a810e4bfd1e5ec0869dfa3bdefd3a1d42_icgraph_map" id="class_spatial_hashing_a810e4bfd1e5ec0869dfa3bdefd3a1d42_icgraph">
<area shape="rect" href="class_spatial_hashing.html#a7bfce8fdfb8f8afe9a23fe1fe39875fe" title="hash a position to a hash key" alt="" coords="219,5,411,32"/><area shape="rect" href="class_spatial_hashing.html#acd1b87ec8ea289a18d431b7a3fde50c0" title="refresh the hash map at each iteration" alt="" coords="459,5,669,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acd1b87ec8ea289a18d431b7a3fde50c0"></a><!-- doxytag: member="SpatialHashing::refreshHashmap" ref="acd1b87ec8ea289a18d431b7a3fde50c0" args="(std::vector&lt; FluidParticle &gt; &amp;_particleList)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SpatialHashing::refreshHashmap </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="class_fluid_particle.html">FluidParticle</a> &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>_particleList</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>refresh the hash map at each iteration </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_particleList</em>&nbsp;</td><td>the fluid particles </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00147">147</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p>References <a class="el" href="_spatial_hashing_8cpp_source.html#l00136">hashPosition()</a>, and <a class="el" href="_spatial_hashing_8h_source.html#l00063">m_hashMap</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00148"></a>00148 {
<a name="l00149"></a>00149 <span class="preprocessor">#pragma omp for schedule(dynamic, 50)</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>    <span class="comment">//loop through each particle in the fluid</span>
<a name="l00151"></a>00151     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _particleList.size(); ++i)
<a name="l00152"></a>00152     {
<a name="l00153"></a>00153         <span class="comment">//hash position</span>
<a name="l00154"></a>00154         <span class="keywordtype">int</span> hashKey = <a class="code" href="class_spatial_hashing.html#a7bfce8fdfb8f8afe9a23fe1fe39875fe" title="hash a position to a hash key">hashPosition</a>(_particleList[i].getCurrentPosition());
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="preprocessor">#pragma omp critical</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>        <span class="comment">//add (hashkey, particle) pair to hashmap</span>
<a name="l00158"></a>00158         <a class="code" href="class_spatial_hashing.html#aa4c4c1eaf23e54dd42cc982a4e53ceaf" title="the spatial hash map">m_hashMap</a>.insert(std::pair&lt;int, FluidParticle&gt;(hashKey, _particleList[i]));
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="class_spatial_hashing_acd1b87ec8ea289a18d431b7a3fde50c0_cgraph.png" border="0" usemap="#class_spatial_hashing_acd1b87ec8ea289a18d431b7a3fde50c0_cgraph_map" alt=""></div>
<map name="class_spatial_hashing_acd1b87ec8ea289a18d431b7a3fde50c0_cgraph_map" id="class_spatial_hashing_acd1b87ec8ea289a18d431b7a3fde50c0_cgraph">
<area shape="rect" href="class_spatial_hashing.html#a7bfce8fdfb8f8afe9a23fe1fe39875fe" title="hash a position to a hash key" alt="" coords="264,31,456,57"/><area shape="rect" href="class_spatial_hashing.html#addbd2cd5fde1521533a54ade79787dde" title="discretise an array of vectors into an array of integers" alt="" coords="505,5,724,32"/><area shape="rect" href="class_spatial_hashing.html#a810e4bfd1e5ec0869dfa3bdefd3a1d42" title="calculate the modulus of 2 numbers" alt="" coords="532,56,697,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af5c8f67520bfd03e32800e87af56ffba"></a><!-- doxytag: member="SpatialHashing::searchFluidParticleNeighbours" ref="af5c8f67520bfd03e32800e87af56ffba" args="(const ngl::Vector _centerPosition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="class_fluid_particle.html">FluidParticle</a> &gt; SpatialHashing::searchFluidParticleNeighbours </td>
          <td>(</td>
          <td class="paramtype">const ngl::Vector&nbsp;</td>
          <td class="paramname"> <em>_centerPosition</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return neighbours of a particle </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_centerPosition</em>&nbsp;</td><td>the particle's position </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8cpp_source.html#l00231">231</a> of file <a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a>.</p>

<p>References <a class="el" href="_spatial_hashing_8cpp_source.html#l00124">discretizingVector()</a>, <a class="el" href="_spatial_hashing_8cpp_source.html#l00191">getNeighbouringCells()</a>, and <a class="el" href="_spatial_hashing_8h_source.html#l00066">m_cellSize</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00232"></a>00232 {
<a name="l00233"></a>00233     <span class="comment">//initialise temp neighbour lists</span>
<a name="l00234"></a>00234     std::vector&lt;FluidParticle&gt; neighbourList;
<a name="l00235"></a>00235     <span class="comment">//neighbourList.reserve(m_initialNeighbourListSize);</span>
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     std::vector&lt;FluidParticle&gt; neighbourTempList;
<a name="l00238"></a>00238     <span class="comment">//neighbourTempList.reserve(m_initialNeighbourListSize);</span>
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     <span class="comment">//first, get neighbours @ centerposition</span>
<a name="l00241"></a>00241     <a class="code" href="class_spatial_hashing.html#ad75a31f38142a1c2a03eda6afed94db3" title="determine neighbours of a fluid particle, given its position">getNeighbouringCells</a>(_centerPosition, <span class="keyword">false</span>, neighbourTempList);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="comment">//then, get neighbours from bounding box [centerPos - cellSize, centerPos + cellSize]</span>
<a name="l00244"></a>00244     ngl::Vector limit(<a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a>, <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a>, <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a>);
<a name="l00245"></a>00245     std::vector&lt;int&gt; discreteMinBounds = <a class="code" href="class_spatial_hashing.html#addbd2cd5fde1521533a54ade79787dde" title="discretise an array of vectors into an array of integers">discretizingVector</a>(_centerPosition - limit);
<a name="l00246"></a>00246     std::vector&lt;int&gt; discreteMaxBounds = <a class="code" href="class_spatial_hashing.html#addbd2cd5fde1521533a54ade79787dde" title="discretise an array of vectors into an array of integers">discretizingVector</a>(_centerPosition + limit);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="comment">//loop from minBound to maxBound and find neighbours in hashmap</span>
<a name="l00249"></a>00249     ngl::Real sampleStep = 0.85;
<a name="l00250"></a>00250     <span class="keywordflow">for</span> (ngl::Real x = discreteMinBounds[0]; x &lt; discreteMaxBounds[0]; x += sampleStep)
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252         <span class="keywordflow">for</span> (ngl::Real y = discreteMinBounds[1]; y &lt; discreteMaxBounds[1]; y += sampleStep)
<a name="l00253"></a>00253         {
<a name="l00254"></a>00254             <span class="keywordflow">for</span> (ngl::Real z = discreteMinBounds[2]; z &lt; discreteMaxBounds[2]; z += sampleStep)
<a name="l00255"></a>00255             {
<a name="l00256"></a>00256                 <span class="comment">//fill in neighbour list with neighbours @ test position(x,y,z)</span>
<a name="l00257"></a>00257                 <a class="code" href="class_spatial_hashing.html#ad75a31f38142a1c2a03eda6afed94db3" title="determine neighbours of a fluid particle, given its position">getNeighbouringCells</a>(ngl::Vector(x, y, z), <span class="keyword">true</span>, neighbourTempList);
<a name="l00258"></a>00258             }
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="comment">//do a final distance check to ensure neighbours are within smoothing length</span>
<a name="l00263"></a>00263     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; neighbourTempList.size(); ++i)
<a name="l00264"></a>00264     {
<a name="l00265"></a>00265         <span class="comment">//get separation distance between centerposition and neighbour position</span>
<a name="l00266"></a>00266         ngl::Real distance = (_centerPosition - neighbourTempList[i].getCurrentPosition()).length();
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         <span class="comment">//add to final list only if distance is within smoothing length (cell size)</span>
<a name="l00269"></a>00269         <span class="keywordflow">if</span> (distance &lt; <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a>) neighbourList.push_back(neighbourTempList[i]);
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="comment">//return final list</span>
<a name="l00273"></a>00273     <span class="keywordflow">return</span> neighbourList;
<a name="l00274"></a>00274 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="class_spatial_hashing_af5c8f67520bfd03e32800e87af56ffba_cgraph.png" border="0" usemap="#class_spatial_hashing_af5c8f67520bfd03e32800e87af56ffba_cgraph_map" alt=""></div>
<map name="class_spatial_hashing_af5c8f67520bfd03e32800e87af56ffba_cgraph_map" id="class_spatial_hashing_af5c8f67520bfd03e32800e87af56ffba_cgraph">
<area shape="rect" href="class_spatial_hashing.html#addbd2cd5fde1521533a54ade79787dde" title="discretise an array of vectors into an array of integers" alt="" coords="357,5,576,32"/><area shape="rect" href="class_spatial_hashing.html#ad75a31f38142a1c2a03eda6afed94db3" title="determine neighbours of a fluid particle, given its position" alt="" coords="348,56,585,83"/><area shape="rect" href="class_particle.html#a7bb9e571a782e273da7efcf77b3b578f" title="return the current position" alt="" coords="636,31,815,57"/><area shape="rect" href="class_particle.html#ad9688047786047c9fecf0c304b4f6294" title="return the id" alt="" coords="675,81,776,108"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a430ce0c699a8ef34a5f8f152d59f06a8"></a><!-- doxytag: member="SpatialHashing::setCellSize" ref="a430ce0c699a8ef34a5f8f152d59f06a8" args="(const ngl::Real _size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SpatialHashing::setCellSize </td>
          <td>(</td>
          <td class="paramtype">const ngl::Real&nbsp;</td>
          <td class="paramname"> <em>_size</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>set the cell size of the spatial structure </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_size</em>&nbsp;</td><td>the new cell size </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00058">58</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>

<p>References <a class="el" href="_spatial_hashing_8h_source.html#l00066">m_cellSize</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00058"></a>00058 { <a class="code" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c" title="the cell size used for spatial calculations">m_cellSize</a> = _size; }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aed10321da282b758d14dd3112749197c"></a><!-- doxytag: member="SpatialHashing::m_cellSize" ref="aed10321da282b758d14dd3112749197c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="class_spatial_hashing.html#aed10321da282b758d14dd3112749197c">SpatialHashing::m_cellSize</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>the cell size used for spatial calculations </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00066">66</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>

</div>
</div>
<a class="anchor" id="a99c2a49c03963d35b4961c51642582b3"></a><!-- doxytag: member="SpatialHashing::m_firstLargePrimeNumber" ref="a99c2a49c03963d35b4961c51642582b3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_spatial_hashing.html#a99c2a49c03963d35b4961c51642582b3">SpatialHashing::m_firstLargePrimeNumber</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>large prime number 1 </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00072">72</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa4c4c1eaf23e54dd42cc982a4e53ceaf"></a><!-- doxytag: member="SpatialHashing::m_hashMap" ref="aa4c4c1eaf23e54dd42cc982a4e53ceaf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_spatial_hashing_8h.html#a1b38b0ad37d6e1390643e8d735273c7f">hashmap</a> <a class="el" href="class_spatial_hashing.html#aa4c4c1eaf23e54dd42cc982a4e53ceaf">SpatialHashing::m_hashMap</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>the spatial hash map </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00063">63</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>

</div>
</div>
<a class="anchor" id="a553569ddd4a57714697c57b70e850d9d"></a><!-- doxytag: member="SpatialHashing::m_initialNeighbourListSize" ref="a553569ddd4a57714697c57b70e850d9d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_spatial_hashing.html#a553569ddd4a57714697c57b70e850d9d">SpatialHashing::m_initialNeighbourListSize</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>reserved space size for neighbours </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00081">81</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3062fc7637f6ba8aca2d4b74a3f96b9b"></a><!-- doxytag: member="SpatialHashing::m_mapSize" ref="a3062fc7637f6ba8aca2d4b74a3f96b9b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_spatial_hashing.html#a3062fc7637f6ba8aca2d4b74a3f96b9b">SpatialHashing::m_mapSize</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>the map size </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00069">69</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>

</div>
</div>
<a class="anchor" id="a80745b4791c3f19b1c2170c18b0832ac"></a><!-- doxytag: member="SpatialHashing::m_secondLargePrimeNumber" ref="a80745b4791c3f19b1c2170c18b0832ac" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_spatial_hashing.html#a80745b4791c3f19b1c2170c18b0832ac">SpatialHashing::m_secondLargePrimeNumber</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>large prime number 2 </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00075">75</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>

</div>
</div>
<a class="anchor" id="a705bb42422d5edd7d8605f95618760c1"></a><!-- doxytag: member="SpatialHashing::m_thirdLargePrimeNumber" ref="a705bb42422d5edd7d8605f95618760c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_spatial_hashing.html#a705bb42422d5edd7d8605f95618760c1">SpatialHashing::m_thirdLargePrimeNumber</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>large prime number 3 </p>

<p>Definition at line <a class="el" href="_spatial_hashing_8h_source.html#l00078">78</a> of file <a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/<a class="el" href="_spatial_hashing_8h_source.html">SpatialHashing.h</a></li>
<li>src/<a class="el" href="_spatial_hashing_8cpp_source.html">SpatialHashing.cpp</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Sun Dec 18 03:11:22 2011 for Smooth Particle Hydrodynamics Solver for Lagrangian Fluid Simulation by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
